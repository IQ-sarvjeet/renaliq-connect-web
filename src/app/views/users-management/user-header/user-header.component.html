<div class="main-container container">
    <div class="row">
      <div class="col-12 col-md-6 col-lg-7 align-item-center d-flex">
        <div class="mt-3">
          <h1 class="page-title m-0">Users</h1>
          <ol class="breadcrumb flex-nowrap">
            <li class="breadcrumb-item">
              <a routerLink="/">Home</a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">Users</li>
          </ol>
        </div>
      </div>
      <div class="col-12 col-md-6 col-lg-5 pt-1 text-sm-end">
        <div class="d-flex g-2 mb-1 mb-md-0">
          <div class="flex-fill">
            <div class="main-header-center">
              <div class="position-relative">
                <input placeholder="Search User by Name or Email Address..."
                  type="search" class="form-control"
                  [(ngModel)]="userFilter.searchKey"
                  (keyup)="filterUsers()"
                  >
                <button class="btn ps-0">
                  <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" viewBox="0 0 24 24"><path _ngcontent-alf-c162="" d="M21.2529297,17.6464844l-2.8994141-2.8994141c-0.0021973-0.0021973-0.0043945-0.0043945-0.0065918-0.0065918c-0.8752441-0.8721313-2.2249146-0.9760132-3.2143555-0.3148804l-0.8467407-0.8467407c1.0981445-1.2668457,1.7143555-2.887146,1.715332-4.5747681c0.0021973-3.8643799-3.1286621-6.9989014-6.993042-7.0011597S2.0092773,5.1315308,2.007019,8.9959106S5.1356201,15.994812,9,15.9970703c1.6889038,0.0029907,3.3114014-0.6120605,4.5789185-1.7111206l0.84729,0.84729c-0.6630859,0.9924316-0.5566406,2.3459473,0.3208618,3.2202759l2.8994141,2.8994141c0.4780884,0.4786987,1.1271973,0.7471313,1.8037109,0.7460938c0.6766357,0.0001831,1.3256226-0.2686768,1.803894-0.7472534C22.2493286,20.2558594,22.2488403,18.6417236,21.2529297,17.6464844z M9.0084229,14.9970703c-3.3120728,0.0023193-5.9989624-2.6807861-6.0012817-5.9928589S5.6879272,3.005249,9,3.0029297c1.5910034-0.0026855,3.1175537,0.628479,4.2421875,1.7539062c1.1252441,1.1238403,1.7579956,2.6486206,1.7590942,4.2389526C15.0036011,12.3078613,12.3204956,14.994751,9.0084229,14.9970703z M20.5458984,20.5413818c-0.604126,0.6066284-1.5856934,0.6087036-2.1923828,0.0045166l-2.8994141-2.8994141c-0.2913818-0.2910156-0.4549561-0.6861572-0.4544678-1.0979614C15.0006714,15.6928101,15.6951294,15,16.5507812,15.0009766c0.4109497-0.0005493,0.8051758,0.1624756,1.0957031,0.453125l2.8994141,2.8994141C21.1482544,18.9584351,21.1482544,19.9364624,20.5458984,20.5413818z"></path></svg>
                </button>
              </div>
            </div>
          </div>
          <div class="ps-3 d-flex align-items-stretch">
            <a href="javascript: void(0)" class="btn btn-block btn-outline-secondary py-1 px-4 d-flex align-items-center" data-bs-target="#modalAddUser"
            data-bs-toggle="modal">
                <i class="fa fa-plus me-1"></i> Add User 
            </a>
          </div>
          <a
            data-bs-target="#modalUsersFilter"
            (click)="resetFilterPopup()"
            data-bs-toggle="modal"
            href="javascript:void(0)"
            class="text-secondary fs-21 align-middle"
            style="padding-left: 13px; line-height: 51px;"
          ><i class="fa fa-filter"></i
        ></a>
        </div>
      </div>
    </div>
    <div class="row mb-4">
      <div class="col-12">
        <div class="flex-fill">
          <div class="d-md-flex">
            <div class="d-none d-md-flex flex-fill pe-3 align-items-center">
              <div>
                <div class="tags mt-1 me-2" *ngIf="rolesFilter.length && submitFilter">
                  User Role: <b>{{rolesFilter}}</b>
                  <a href="Javascript:void(0)" class="tags__icon" (click)="clearFilter('userRole')">x</a>
                </div>
                <div class="tags mt-1 me-2" *ngIf="statusFilter.length && submitFilter">
                  User Status: <b>{{statusFilter}}</b>
                  <a href="Javascript:void(0)" class="tags__icon" (click)="clearFilter('userStatus')">x</a>
                </div>
                <div class="tags mt-1 me-2" *ngIf="userFilter.practice !== '' && submitFilter">
                  Practice: <b>{{userFilter.practice}}</b>
                  <a href="Javascript:void(0)" class="tags__icon" (click)="clearFilter('userPractice')">x</a>
                </div>
                <div class="tags mt-1 me-2" *ngIf="(userFilter.fromDate && userFilter.toDate) && submitFilter">
                  Created Created On: <b>{{moment(userFilter.fromDate).format("MM/DD/YYYY") + ' to ' + moment(userFilter.toDate).format("MM/DD/YYYY")}}</b>
                  <a href="Javascript:void(0)" class="tags__icon" (click)="clearFilter('filterDate')">x</a>
                </div>
              </div>
            </div>
            <div class="pt-2 text-nowrap text-end">
              <div class="tags mt-1 me-2"
                *ngIf="(rolesFilter.length || statusFilter.length || userFilter.practice !== '' || (userFilter.fromDate && userFilter.toDate)) && submitFilter">
                Clear Filters<a href="Javascript:void(0)" class="tags__icon" (click)="clearFilterHandler()">x</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- Add User MODAL -->
<div class="modal fade" id="modalAddUser">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content modal-content-demo">
        <form [formGroup]="addUserForm" (ngSubmit)="submit()">
          <div class="modal-header bg-gray-200">
            <h4 class="modal-title fw-semibold">Add User</h4>
            <button type="button" aria-label="Close" data-bs-dismiss="modal" class="btn-close" (click)="resetForm()">
              <span aria-hidden="true">Ã—</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="form-row">
              <div class="col-12 mb-3">
                <div class="form-floating">
                  <input type="text" placeholder="Email/Login ID" formControlName="email" id="userEmail"
                    class="form-control">
                  <label for="userEmail" class="mb-1">Email/Login ID <span class="text-danger">*</span></label>
                </div>
                <div class="text-danger" *ngIf="addUserForm.controls['email'].invalid && addUserForm.controls['email'].touched">Please enter valid email</div>
              </div>
            </div>
            <div class="form-row">
              <div class="col-6 mb-3">
                <div class="form-floating">
                  <input type="text" placeholder="First Name" formControlName="firstName" id="firstName" class="form-control" />
                  <label for="firstName" class="mb-1">First Name <span class="text-danger">*</span></label>
                </div>
                <div class="text-danger" *ngIf="addUserForm.controls['firstName'].invalid && addUserForm.controls['firstName'].touched">Please enter valid first name</div>
              </div>
              <div class="col-6 mb-3">
                <div class="form-floating">
                  <input type="text" placeholder="Last Name" formControlName="lastName" id="lastName" class="form-control">
                  <label for="lastName" class="mb-1">Last Name <span class="text-danger">*</span></label>
                </div>
                <div class="text-danger" *ngIf="addUserForm.controls['lastName'].invalid && addUserForm.controls['lastName'].touched">Please enter valid last name</div>
              </div>
            </div>
            <div class="form-row">
              <div class="col-6 mb-3">
                <div class="form-floating">
                  <input type="text" placeholder="Mobile Number" formControlName="phoneNumber" id="phoneNumber" class="form-control">
                  <label for="phoneNumber" class="mb-1">Mobile Number</label>
                </div>
                <div class="text-danger" *ngIf="addUserForm.controls['phoneNumber'].invalid && addUserForm.controls['phoneNumber'].touched">Please enter valid contact number</div>
              </div>
              <div class="col-6 mb-3">
                <div class="form-floating">
                  <input type="text" placeholder="Title" formControlName="title" id="title"
                    class="form-control">
                  <label for="title" class="mb-1">Title</label>
                </div>
              </div>
            </div>
            <div class="form-row">
              <div class="col-12 mb-3">
                <div class="form-floating">
                  <select class="form-select" id="roleId" formControlName="roleId">
                    <option value="" selected>-Select-</option>
                    <option [value]="role.id" *ngFor="let role of rolesList">{{ role.name }}</option>
                  </select>
                  <label for="roleId" class="mb-1">User Role <span class="text-danger">*</span></label>
                </div>
                <div class="text-danger" *ngIf="addUserForm.controls['roleId'].invalid && addUserForm.controls['roleId'].touched">Please select user role</div>
              </div>
            </div>
            <div class="form-row">
              <div class="col-12">
                <mbsc-select [data]="practicesList" 
                  formControlName="practiceId"
                  display="anchored" 
                  [itemHeight]="50" 
                  [selectMultiple]="true" 
                  label="Assign Practices *" 
                  class="form-control select-tags" 
                  inputStyle="box" 
                  labelStyle="stacked" 
                  placeholder="Assign Practices *"
                >
                </mbsc-select>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline-light" data-bs-dismiss="modal" type="button" (click)="resetForm()">
              Cancel
            </button>
            <button class="btn btn-secondary" data-bs-dismiss="modal" type="submit" [disabled]="!addUserForm.valid">
              Add User
            </button>
          </div>
        </form>
      </div>
    </div>
</div>

<!-- FILTER MODAL -->
<div class="modal fade" id="modalUsersFilter">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content modal-content-demo">
      <div class="modal-header bg-gray-200">
        <h4 class="modal-title fw-semibold">Filter Users</h4>
        <button aria-label="Close" class="btn-close" data-bs-dismiss="modal">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <app-spinner *ngIf="practicesLoading"></app-spinner>
        <div class="form-row">
          <div class="col-12">
            <label for="searchPatient" class="mb-1">User Role</label>
            <mbsc-select [data]="rolesListForFilter" *ngIf="rolesListForFilter.length"
              class="form-control form-control-mbsc"
              id="role"
              placeholder="Select"
              [selectMultiple]="true"
              [(ngModel)]="userFilter.userRole"
              (change)="getPractices()"
            >
            </mbsc-select>
          </div>
        </div>
        <div class="form-row mt-4">
          <div class="col-12" id="practice-filter">
            <label for="stage" class="mb-1">Practice Assigned</label>
            <app-typeahead 
              [dataList]="{ 
                data: practiceFilter,
                defaultSelected: userFilter.practice,
                classParentElement: 'none'
              }"
              (itemSelected)="itemSelected($event)"></app-typeahead>
          </div>
        </div>
        <div class="form-row mt-4">
          <div class="col-6">
            <label for="stage" class="mb-1">User Status</label>
            <mbsc-select [data]="userStatus"
              class="form-control form-control-mbsc"
              id="stage"
              placeholder="Select"
              [selectMultiple]="true"
              [(ngModel)]="userFilter.userStatus"
            >
            </mbsc-select>
          </div>
          <div class="col-6">
            <label for="stage" class="mb-1">User Created On</label>
            <div class="input-group">
              <mbsc-datepicker
                  id="admissionsPeriod"
                  class="form-control pe-0 fs-12"
                  #rangeDatepicker
                  [options]="dateRangeOptions"
                  placeholder="Select date range"
              ></mbsc-datepicker>
              <button
                  class="input-group-text bg-white"
                  type="button"
                  (click)="rangeDatepicker.open()"
              >
                  <i class="fa fa-calendar"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button
          class="btn btn-secondary"
          data-bs-dismiss="modal"
          (click)="filterUsers()"
        >
          Update
        </button>
    </div>
  </div>
</div>
</div>